<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>every me âœ¦</title>
  <meta name="description" content="ä¸€ç¬ã®ç§ã‚’ã€365æ—¥åˆ†ã€‚æ¯æ—¥ã®è‡ªåˆ†ã‚’è¨˜éŒ²ã™ã‚‹ãƒ€ã‚¤ã‚¢ãƒªãƒ¼ã‚¢ãƒ—ãƒª" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: linear-gradient(135deg, #fdf6f0 0%, #fce8e8 40%, #f5e6f8 100%); min-height: 100vh; }
    button { font-family: inherit; }
    textarea { font-family: inherit; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    const MONTHS_JA = ["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"];
    const DAYS_JA = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
    const today = new Date();
    const todayKey = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")}`;

    function dateKey(year, month, day) {
      return `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    }
    function getDaysInMonth(year, month) { return new Date(year, month + 1, 0).getDate(); }
    function getFirstDayOfMonth(year, month) { return new Date(year, month, 1).getDay(); }

    const store = {
      getAll() {
        const result = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith("diary:")) {
            try { result[key.replace("diary:", "")] = JSON.parse(localStorage.getItem(key)); } catch {}
          }
        }
        return result;
      },
      set(dateStr, value) { localStorage.setItem(`diary:${dateStr}`, JSON.stringify(value)); }
    };

    function App() {
      const [entries, setEntries] = useState({});
      const [view, setView] = useState("grid");
      const [selectedDate, setSelectedDate] = useState(todayKey);
      const [currentYear, setCurrentYear] = useState(today.getFullYear());
      const [currentMonth, setCurrentMonth] = useState(today.getMonth());
      const [draftPhoto, setDraftPhoto] = useState(null);
      const [draftComment, setDraftComment] = useState("");
      const [shareToast, setShareToast] = useState(false);
      const fileRef = useRef();

      useEffect(() => { setEntries(store.getAll()); }, []);

      const saveEntry = (dateStr, photo, comment) => {
        const entry = { photo, comment, savedAt: new Date().toISOString() };
        store.set(dateStr, entry);
        setEntries(prev => ({ ...prev, [dateStr]: entry }));
      };

      const handleFileChange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => setDraftPhoto(ev.target.result);
        reader.readAsDataURL(file);
      };

      const handleSave = () => {
        if (!draftPhoto) return;
        saveEntry(selectedDate, draftPhoto, draftComment);
        setDraftPhoto(null); setDraftComment(""); setView("entry");
      };

      const openDay = (dateStr) => {
        setSelectedDate(dateStr);
        if (entries[dateStr]) { setView("entry"); }
        else if (new Date(dateStr) <= new Date(todayKey)) {
          setDraftPhoto(null); setDraftComment(""); setView("new");
        }
      };

      const handleShare = () => {
        const entry = entries[selectedDate];
        if (!entry) return;
        const text = `${selectedDate}ã®ç§ ğŸ“¸\n"${entry.comment || "ä»Šæ—¥ã‚‚ç´ æ•µãªä¸€æ—¥"}"\n#æ¯æ—¥ã®ç§ #365diary #everyMe`;
        if (navigator.share) { navigator.share({ title: "every me âœ¦", text }).catch(() => {}); }
        else { navigator.clipboard.writeText(text).then(() => { setShareToast(true); setTimeout(() => setShareToast(false), 2500); }); }
      };

      const daysInMonth = getDaysInMonth(currentYear, currentMonth);
      const firstDay = getFirstDayOfMonth(currentYear, currentMonth);
      const prevMonth = () => { if (currentMonth === 0) { setCurrentMonth(11); setCurrentYear(y => y-1); } else setCurrentMonth(m => m-1); };
      const nextMonth = () => { if (currentMonth === 11) { setCurrentMonth(0); setCurrentYear(y => y+1); } else setCurrentMonth(m => m+1); };
      const entryForSelected = entries[selectedDate];
      const formatDisplayDate = (dateStr) => {
        const [y, m, d] = dateStr.split("-");
        const dow = new Date(dateStr).getDay();
        return `${y}å¹´ ${parseInt(m)}æœˆ${parseInt(d)}æ—¥ï¼ˆ${DAYS_JA[dow]}ï¼‰`;
      };

      return (
        <div style={{ minHeight:"100vh", background:"linear-gradient(135deg,#fdf6f0 0%,#fce8e8 40%,#f5e6f8 100%)", fontFamily:"'Hiragino Kaku Gothic ProN','Noto Sans JP',sans-serif", position:"relative", overflow:"hidden" }}>
          {/* Blobs */}
          {[{size:320,top:-80,left:-80,color:"rgba(255,182,193,0.18)"},{size:200,bottom:100,right:-60,color:"rgba(216,180,254,0.2)"},{size:140,top:"40%",right:40,color:"rgba(254,215,170,0.22)"}].map((c,i) => (
            <div key={i} style={{ position:"fixed", borderRadius:"50%", width:c.size, height:c.size, top:c.top, bottom:c.bottom, left:c.left, right:c.right, background:c.color, pointerEvents:"none", zIndex:0, filter:"blur(40px)" }} />
          ))}

          <div style={{ position:"relative", zIndex:1, maxWidth:430, margin:"0 auto", padding:"0 0 80px" }}>
            {/* Header */}
            <div style={{ textAlign:"center", padding:"36px 20px 16px", borderBottom:"1px solid rgba(200,160,160,0.15)" }}>
              <div style={{ fontSize:11, letterSpacing:"0.35em", color:"#c9a0a0", textTransform:"uppercase", marginBottom:6, fontWeight:600 }}>my 365 days</div>
              <h1 style={{ margin:0, fontSize:32, fontWeight:800, background:"linear-gradient(135deg,#e8758a 0%,#c97bb5 60%,#9b7fd4 100%)", WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent", letterSpacing:"-0.02em", lineHeight:1.1 }}>every me âœ¦</h1>
              <div style={{ fontSize:11, color:"#c9a0a0", marginTop:6, letterSpacing:"0.1em" }}>ä¸€ç¬ã®ç§ã‚’ã€365æ—¥åˆ†ã€‚</div>
            </div>

            {/* GRID */}
            {view === "grid" && (
              <div style={{ padding:"20px 16px" }}>
                <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:18 }}>
                  <button onClick={prevMonth} style={{ background:"rgba(255,240,248,0.8)", border:"1.5px solid rgba(200,160,190,0.25)", borderRadius:10, width:36, height:36, fontSize:18, cursor:"pointer", color:"#c97bb5" }}>â€¹</button>
                  <div style={{ fontSize:17, fontWeight:700, color:"#9b6e8a" }}>{currentYear}å¹´ {MONTHS_JA[currentMonth]}</div>
                  <button onClick={nextMonth} style={{ background:"rgba(255,240,248,0.8)", border:"1.5px solid rgba(200,160,190,0.25)", borderRadius:10, width:36, height:36, fontSize:18, cursor:"pointer", color:"#c97bb5" }}>â€º</button>
                </div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(7,1fr)", gap:4, marginBottom:4 }}>
                  {DAYS_JA.map((d,i) => <div key={d} style={{ textAlign:"center", fontSize:10, fontWeight:700, color:i===0?"#e88":i===6?"#88b":"#bba0a0", padding:"4px 0" }}>{d}</div>)}
                </div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(7,1fr)", gap:5 }}>
                  {Array.from({length:firstDay}).map((_,i) => <div key={`e${i}`} />)}
                  {Array.from({length:daysInMonth}).map((_,i) => {
                    const day = i+1;
                    const dk = dateKey(currentYear, currentMonth, day);
                    const entry = entries[dk];
                    const isToday = dk === todayKey;
                    const isFuture = new Date(dk) > new Date(todayKey);
                    return (
                      <button key={dk} onClick={() => !isFuture && openDay(dk)} style={{ aspectRatio:"1", borderRadius:10, overflow:"hidden", position:"relative", border:isToday?"2.5px solid #e8758a":"2px solid rgba(200,160,160,0.18)", cursor:isFuture?"default":"pointer", background:entry?"transparent":isFuture?"rgba(240,235,250,0.3)":"rgba(255,240,245,0.6)", padding:0, transition:"transform 0.15s", boxShadow:isToday?"0 0 0 4px rgba(232,117,138,0.15)":"0 1px 4px rgba(180,140,160,0.1)" }}
                        onMouseEnter={e => { if(!isFuture) e.currentTarget.style.transform="scale(1.06)"; }}
                        onMouseLeave={e => { e.currentTarget.style.transform="scale(1)"; }}
                      >
                        {entry?.photo && <img src={entry.photo} alt="" style={{ width:"100%", height:"100%", objectFit:"cover", display:"block" }} />}
                        <div style={{ position:"absolute", inset:0, display:"flex", alignItems:entry?.photo?"flex-end":"center", justifyContent:"center", background:entry?.photo?"linear-gradient(transparent 50%,rgba(0,0,0,0.35))":"none", padding:2 }}>
                          <span style={{ fontSize:entry?.photo?8:11, fontWeight:700, color:entry?.photo?"#fff":isFuture?"#d0c0d0":"#c9a0b0", lineHeight:1 }}>{day}</span>
                        </div>
                      </button>
                    );
                  })}
                </div>
                {/* Stats */}
                <div style={{ marginTop:20, padding:"14px 18px", background:"rgba(255,255,255,0.6)", borderRadius:16, border:"1px solid rgba(220,180,200,0.2)", display:"flex", justifyContent:"space-around", alignItems:"center" }}>
                  {[
                    { label:"è¨˜éŒ²ã—ãŸæ—¥", value:Object.keys(entries).length, unit:"æ—¥" },
                    { label:"ä»Šå¹´ã®è¨˜éŒ²", value:Object.keys(entries).filter(k=>k.startsWith(String(today.getFullYear()))).length, unit:"æš" },
                    { label:"é”æˆç‡", value:Math.floor(Object.keys(entries).length/365*100), unit:"%" },
                  ].map(s => (
                    <div key={s.label} style={{ textAlign:"center" }}>
                      <div style={{ fontSize:24, fontWeight:800, color:"#c97bb5", lineHeight:1 }}>{s.value}<span style={{ fontSize:13 }}>{s.unit}</span></div>
                      <div style={{ fontSize:10, color:"#c9a0a0", marginTop:3 }}>{s.label}</div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* ENTRY */}
            {view === "entry" && entryForSelected && (
              <div style={{ padding:"20px 16px" }}>
                <button onClick={() => setView("grid")} style={{ background:"none", border:"none", cursor:"pointer", color:"#c9a0b0", fontSize:12, padding:"4px 0", marginBottom:8, display:"block", fontWeight:600 }}>â† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
                <div style={{ fontSize:13, color:"#c9a0b0", textAlign:"center", marginBottom:16 }}>{formatDisplayDate(selectedDate)}</div>
                <div style={{ background:"#fff", borderRadius:4, padding:"12px 12px 20px", boxShadow:"0 8px 32px rgba(180,120,160,0.18)", transform:"rotate(-0.8deg)", margin:"0 auto", maxWidth:320, transition:"transform 0.3s" }}
                  onMouseEnter={e => e.currentTarget.style.transform="rotate(0deg) scale(1.01)"}
                  onMouseLeave={e => e.currentTarget.style.transform="rotate(-0.8deg)"}
                >
                  <div style={{ borderRadius:2, overflow:"hidden", background:"#f5e8e8", aspectRatio:"1" }}>
                    {entryForSelected.photo ? <img src={entryForSelected.photo} alt="" style={{ width:"100%", height:"100%", objectFit:"cover", display:"block" }} /> : <div style={{ display:"flex", alignItems:"center", justifyContent:"center", height:"100%", fontSize:48 }}>ğŸ“·</div>}
                  </div>
                  <div style={{ marginTop:14, textAlign:"center", minHeight:32 }}>
                    <p style={{ margin:0, fontSize:14, color:"#7a5a7a", fontStyle:"italic", lineHeight:1.6 }}>{entryForSelected.comment || "âœ¦"}</p>
                  </div>
                </div>
                <div style={{ display:"flex", gap:10, justifyContent:"center", marginTop:24 }}>
                  <button onClick={handleShare} style={{ padding:"11px 22px", borderRadius:12, background:"linear-gradient(135deg,#e8758a,#e8758acc)", color:"#fff", border:"none", cursor:"pointer", fontSize:13, fontWeight:700 }}>ğŸ“¤ ã‚·ã‚§ã‚¢ã™ã‚‹</button>
                  <button onClick={() => { setDraftPhoto(entryForSelected.photo); setDraftComment(entryForSelected.comment||""); setView("new"); }} style={{ padding:"11px 22px", borderRadius:12, background:"linear-gradient(135deg,#b9a0d4,#b9a0d4cc)", color:"#fff", border:"none", cursor:"pointer", fontSize:13, fontWeight:700 }}>âœï¸ ç·¨é›†</button>
                </div>
                {shareToast && <div style={{ position:"fixed", bottom:100, left:"50%", transform:"translateX(-50%)", background:"rgba(60,40,60,0.85)", color:"#fff", padding:"10px 20px", borderRadius:20, fontSize:13, zIndex:99 }}>ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ“</div>}
              </div>
            )}

            {/* NEW */}
            {view === "new" && (
              <div style={{ padding:"20px 16px" }}>
                <button onClick={() => setView("grid")} style={{ background:"none", border:"none", cursor:"pointer", color:"#c9a0b0", fontSize:12, padding:"4px 0", marginBottom:8, display:"block", fontWeight:600 }}>â† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
                <div style={{ fontSize:13, color:"#c9a0b0", textAlign:"center", marginBottom:20 }}>{formatDisplayDate(selectedDate)}</div>
                <div onClick={() => fileRef.current.click()} style={{ aspectRatio:"1", maxWidth:300, margin:"0 auto", borderRadius:16, overflow:"hidden", border:draftPhoto?"none":"2.5px dashed rgba(200,150,180,0.5)", background:draftPhoto?"transparent":"rgba(255,240,248,0.7)", cursor:"pointer", position:"relative", display:"flex", alignItems:"center", justifyContent:"center", boxShadow:draftPhoto?"0 8px 24px rgba(180,120,160,0.2)":"none" }}>
                  {draftPhoto ? <img src={draftPhoto} alt="" style={{ width:"100%", height:"100%", objectFit:"cover" }} /> :
                    <div style={{ textAlign:"center" }}>
                      <div style={{ fontSize:48, marginBottom:10 }}>ğŸ“·</div>
                      <div style={{ fontSize:13, color:"#c9a0b0" }}>ä»Šæ—¥ã®ä¸€æšã‚’è¿½åŠ </div>
                      <div style={{ fontSize:11, color:"#d0b0c0", marginTop:4 }}>ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’é¸æŠ</div>
                    </div>
                  }
                </div>
                <input ref={fileRef} type="file" accept="image/*" capture="user" style={{ display:"none" }} onChange={handleFileChange} />
                <div style={{ marginTop:20, maxWidth:300, margin:"20px auto 0" }}>
                  <label style={{ fontSize:11, color:"#c9a0b0", letterSpacing:"0.12em", textTransform:"uppercase", fontWeight:700, display:"block", marginBottom:8 }}>ä»Šæ—¥ã®ã²ã¨ã“ã¨</label>
                  <textarea value={draftComment} onChange={e => setDraftComment(e.target.value)} placeholder="ä»Šæ—¥ã®ç§ã¯â€¦" maxLength={100} style={{ width:"100%", padding:"12px 14px", borderRadius:12, border:"1.5px solid rgba(200,160,190,0.3)", background:"rgba(255,250,252,0.8)", resize:"none", fontSize:14, color:"#7a5a7a", lineHeight:1.7, outline:"none", fontFamily:"inherit" }} rows={3} />
                  <div style={{ fontSize:10, color:"#d0b0c0", textAlign:"right", marginTop:4 }}>{draftComment.length}/100</div>
                </div>
                <div style={{ maxWidth:300, margin:"16px auto 0" }}>
                  <button onClick={handleSave} disabled={!draftPhoto} style={{ width:"100%", padding:"14px", background:draftPhoto?"linear-gradient(135deg,#e8758a,#c97bb5)":"rgba(220,200,220,0.5)", color:draftPhoto?"#fff":"#bfa0bf", border:"none", borderRadius:14, fontSize:14, fontWeight:700, cursor:draftPhoto?"pointer":"not-allowed", letterSpacing:"0.1em", boxShadow:draftPhoto?"0 4px 16px rgba(200,100,160,0.3)":"none" }}>âœ¦ ã“ã®æ—¥ã®ç§ã‚’ä¿å­˜ã™ã‚‹</button>
                </div>
              </div>
            )}

            {/* FAB */}
            {view === "grid" && (
              <button onClick={() => openDay(todayKey)} style={{ position:"fixed", bottom:28, right:"max(16px, calc(50% - 215px + 16px))", width:56, height:56, borderRadius:"50%", background:"linear-gradient(135deg,#e8758a,#c97bb5)", border:"none", cursor:"pointer", boxShadow:"0 4px 20px rgba(200,100,160,0.45)", fontSize:22, display:"flex", alignItems:"center", justifyContent:"center", zIndex:10 }} title="ä»Šæ—¥ã®ä¸€æš">ğŸ“·</button>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
